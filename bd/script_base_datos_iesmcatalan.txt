CREATE TABLE Estudiantes (
    id_estudiante SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,  -- Increased from 50
    apellido_1 VARCHAR(100) NOT NULL,  -- Increased from 50
    apellido_2 VARCHAR(100),  -- Increased from 50
    num_tfno VARCHAR(20),
    num_expediente VARCHAR(100),
    id_legal VARCHAR(20) UNIQUE NOT NULL,
    tipo_id_legal VARCHAR(50) NOT NULL,
    fecha_nac DATE NOT NULL
);

CREATE TABLE Ciclos (
    id_ciclo SERIAL PRIMARY KEY,
    curso VARCHAR(5) NOT NULL,  -- e.g., "1ยบ", "2ยบ"
    nombre VARCHAR(100) NOT NULL,
    codigo VARCHAR(20) NOT NULL,  -- e.g., "SAN202-LOE"
    norma_1 TEXT NOT NULL,
    norma_2 TEXT NOT NULL
);

CREATE TABLE Modulos (
    id_modulo SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    codigo_modulo VARCHAR(50) NOT NULL,
    id_ciclo INT NOT NULL,
    curso VARCHAR(5) NOT NULL,
    FOREIGN KEY (id_ciclo) REFERENCES Ciclos(id_ciclo) ON DELETE CASCADE
);

CREATE TABLE Expedientes (
    id_expediente SERIAL PRIMARY KEY,
    id_estudiante INT NOT NULL,
    ano_inicio INT NOT NULL,  -- e.g., 2023
    ano_fin INT NOT NULL,  -- e.g., 2024
    id_ciclo INT NOT NULL,
    convocatoria VARCHAR(50) NOT NULL CHECK (convocatoria IN ('Ordinaria', 'Extraordinaria')),
    fecha_pago_titulo DATE,
    FOREIGN KEY (id_estudiante) REFERENCES Estudiantes(id_estudiante) ON DELETE CASCADE,
    FOREIGN KEY (id_ciclo) REFERENCES Ciclos(id_ciclo) ON DELETE CASCADE,
    UNIQUE (id_estudiante, id_ciclo, ano_inicio, ano_fin)  -- Prevents duplicates
);

-- tipo personalizado para las notas
CREATE TYPE nota_enum AS ENUM (
    '1','2','3','4','5','6','7','8','9','10',
    '10-MH',
    'CV','CV-5','CV-6','CV-7','CV-8','CV-9','CV-10',
    'AM','RC','NE','APTO','NO APTO'
);

CREATE TABLE Matriculas (
    id_matricula SERIAL PRIMARY KEY,
    id_expediente INT NOT NULL,
    id_modulo INT NOT NULL,
    nota nota_enum,
    FOREIGN KEY (id_expediente) REFERENCES Expedientes(id_expediente) ON DELETE CASCADE,
    FOREIGN KEY (id_modulo) REFERENCES Modulos(id_modulo) ON DELETE CASCADE,
    UNIQUE (id_expediente, id_modulo)  -- Ensures one enrollment per module per expediente
);

CREATE TABLE Directivos (
    cargo VARCHAR(25) PRIMARY KEY,
    nombre VARCHAR(200)
);
